{"version":3,"file":"index.js","sources":["../../src/index.ts"],"sourcesContent":["import {\n  RowData,\n  createTable,\n  TableOptions,\n  TableOptionsResolved,\n} from '@tanstack/table-core'\nimport Placeholder from './placeholder'\nimport type { ComponentType } from 'svelte'\nimport { SvelteComponent } from 'svelte/internal'\nimport { readable, writable, derived, Readable, get } from 'svelte/store'\nimport { renderComponent } from './render-component'\n\nexport { renderComponent } from './render-component'\n\nexport * from '@tanstack/table-core'\n\nfunction isSvelteServerComponent(component: any) {\n  return (\n    typeof component === 'object' &&\n    typeof component.$$render === 'function' &&\n    typeof component.render === 'function'\n  )\n}\n\nfunction isSvelteClientComponent(component: any) {\n  let isHMR = '__SVELTE_HMR' in window\n\n  return (\n    component.prototype instanceof SvelteComponent ||\n    (isHMR &&\n      component.name?.startsWith('Proxy<') &&\n      component.name?.endsWith('>'))\n  )\n}\n\nfunction isSvelteComponent(component: any) {\n  if (typeof document === 'undefined') {\n    return isSvelteServerComponent(component)\n  } else {\n    return isSvelteClientComponent(component)\n  }\n}\n\nfunction wrapInPlaceholder(content: any) {\n  return renderComponent(Placeholder, { content })\n}\n\nexport function flexRender(component: any, props: any): ComponentType | null {\n  if (!component) return null\n\n  if (isSvelteComponent(component)) {\n    return renderComponent(component, props)\n  }\n\n  if (typeof component === 'function') {\n    const result = component(props)\n    if (result === null || result === undefined) return null\n\n    if (isSvelteComponent(result)) {\n      return renderComponent(result, props)\n    }\n\n    return wrapInPlaceholder(result)\n  }\n\n  return wrapInPlaceholder(component)\n}\n\ntype ReadableOrVal<T> = T | Readable<T>\n\nexport function createSvelteTable<TData extends RowData>(\n  options: ReadableOrVal<TableOptions<TData>>\n) {\n  let optionsStore: Readable<TableOptions<TData>>\n\n  if ('subscribe' in options) {\n    optionsStore = options\n  } else {\n    optionsStore = readable(options)\n  }\n\n  let resolvedOptions: TableOptionsResolved<TData> = {\n    state: {}, // Dummy state\n    onStateChange: () => {}, // noop\n    renderFallbackValue: null,\n    ...get(optionsStore),\n  }\n\n  let table = createTable(resolvedOptions)\n\n  let stateStore = writable(/** @type {number} */ table.initialState)\n  // combine stores\n  let stateOptionsStore = derived([stateStore, optionsStore], s => s)\n  const tableReadable = readable(table, function start(set) {\n    const unsubscribe = stateOptionsStore.subscribe(([state, options]) => {\n      table.setOptions(prev => {\n        return {\n          ...prev,\n          ...options,\n          state: { ...state, ...options.state },\n          // Similarly, we'll maintain both our internal state and any user-provided\n          // state.\n          onStateChange: updater => {\n            if (updater instanceof Function) {\n              stateStore.update(updater)\n            } else {\n              stateStore.set(updater)\n            }\n\n            resolvedOptions.onStateChange?.(updater)\n          },\n        }\n      })\n\n      // it didn't seem to rerender without setting the table\n      set(table)\n    })\n\n    return function stop() {\n      unsubscribe()\n    }\n  })\n\n  return tableReadable\n}\n"],"names":["isSvelteServerComponent","component","$$render","render","isSvelteClientComponent","_component$name","_component$name2","isHMR","window","prototype","SvelteComponent","name","startsWith","endsWith","isSvelteComponent","document","wrapInPlaceholder","content","renderComponent","Placeholder","flexRender","props","result","undefined","createSvelteTable","options","optionsStore","readable","resolvedOptions","state","onStateChange","renderFallbackValue","get","table","createTable","stateStore","writable","initialState","stateOptionsStore","derived","s","tableReadable","start","set","unsubscribe","subscribe","_ref","setOptions","prev","updater","Function","update","stop"],"mappings":"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"}